<div class="container">
  <div ng-controller="date-picker-controller as vm">
    <h2 style="text-align:center;">We are in the House</h2>
    <p style="text-align:center;">Type in the following forms the date and the houseID and you will see the chart</p>
    <form class="form-horizontal">
        <div class="form-group has-feedback">
          <label for="exampleInputName2" class="col-sm-2 control-label">Date</label>
            <div class="col-sm-10">
              <input type="text" class="form-control"
                    id="firstForm"
                    datepicker-popup="MMM dd, yyyy"
                    is-open="vm.valuationDatePickerIsOpen"
                    ng-click="vm.valuationDatePickerOpen()"
                    ng-model="initialDate"/>
              <i class="form-control-feedback glyphicon glyphicon-calendar"></i>
          </div>
        </div>
        <div class="form-group">
          <label for="exampleInputName1" class="col-sm-2 control-label">Node ID</label>
          <div class="col-sm-10">
            <select class="form-control" id="node" onchange="choosePhase(value)">
              <option value="611">611</option>
              <option value="645">645</option>
              <option value="646">646</option>
              <option value="652">652</option>
              <option value="671">671</option>
              <option value="675">675</option>
              <option value="692">692</option>
              <option value="6321">6321</option>
              <option value="6711">6711</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="exampleInputName1" class="col-sm-2 control-label">Phase</label>
          <div class="col-sm-10">
            <select class="form-control" id="phase" onchange="changeHouseBasedOnPhase(value)"></select>
          </div>
        </div>
        <div class="form-group">
          <label for="exampleInputName" class="col-sm-2 control-label">House ID</label>
          <div class="col-sm-10">
            <select class="form-control" id="HouseID"></select>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-default" id="open">Search</button>
          </div>
        </div>
    </form>
  </div>
</div>

<script>
    window.choosePhase = function (value){
      var nodeID = $('#node').val();

      $.get('/house-end-point/' +nodeID)

        .done (function( data ){

          var phases = data.map(function(entry, index) {
            return entry.phase;
          });

          var uniquePhases = [];
          $.each(phases, function(i, el){
              if($.inArray(el, uniquePhases) === -1) uniquePhases.push(el);
          });
          $('#phase').empty();

          $.each(uniquePhases, function(key, value) {
            $('#phase')
              .append($("<option></option>")
              .attr("value",value)
              .text(value));
          });
        });
    };

    window.changeHouseBasedOnPhase = function(value) {
      var nodeID = $('#node').val();
      var phase = $('#phase').val();

      $.get('/house-end-point/' +nodeID+ '/' +phase)
        .done (function( data ){
          var houseIDs = data.map(function(entry, index) {
            return entry.houseID;
          });

          $('#HouseID').empty();

          console.log(houseIDs);

          $.each(houseIDs, function(key, value) {
            $('#HouseID')
              .append($("<option></option>")
              .attr("value",key + 1 + nodeID)
              .text(value));
          });
        });
    };

    $('#open').click(function() {
        var URL = '#/houses/multiple-line-chart/',
            slace = '/',
            firstUserEntry = $('#firstForm').val(),
            secondUserEntry = $('#node').val(),
            thirdUserEntry = $('#HouseID').val(),
            fourthUserEntry = $('#phase').val();

            if (firstUserEntry=='Aug 01, 2000') {
              firstUserEntry = '01-08-2000';
            }
            if (firstUserEntry=='Aug 02, 2000') {
              firstUserEntry = '02-08-2000';
            }
            if (firstUserEntry=='Aug 03, 2000') {
              firstUserEntry = '03-08-2000';
            }
            if (firstUserEntry=='Aug 04, 2000') {
              firstUserEntry = '04-08-2000';
            }
            if (firstUserEntry=='Aug 05, 2000') {
              firstUserEntry = '05-08-2000';
            }
            if (firstUserEntry=='Aug 06, 2000') {
              firstUserEntry = '06-08-2000';
            }
            if (firstUserEntry=='Aug 07, 2000') {
              firstUserEntry = '07-08-2000';
            }
        var newWindow = window.open(URL + firstUserEntry + slace + secondUserEntry
                                        + slace + thirdUserEntry + slace + fourthUserEntry, '_blank');
        newWindow.focus();
    });
</script>



